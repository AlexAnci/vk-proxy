# vk-proxy [![Uptime](https://img.shields.io/uptimerobot/ratio/7/m780088591-4c8a704c43ffe8c145057754.svg)](https://xtrafrancyz.net/unblock-vk) [![Online](https://img.shields.io/badge/endpoint.svg?url=https://other.xtrafrancyz.net/vk-proxy-badge/onlineBadge)](https://xtrafrancyz.net/unblock-vk)

Прокси-сервер для приложения ВКонтакте на Android.

Главное преимущество **vk-proxy** перед VPN - это то, что не нужно постоянно запускать VPN, тратить на него батарею и смотреть рекламу перед подключением. С этим прокси вы просто пользуетесь приложением ВК точно так же, как и до блокировок. В отличии от прокси, встроенного в офф. приложение, это работает.

## Установка прокси
Вы можете загрузить уже готовый [релиз](https://github.com/xtrafrancyz/vk-proxy/releases) или собрать прокси из исходников с помощью команды `go get -u github.com/xtrafrancyz/vk-proxy`. После, vk-proxy появится в папке `$GOPATH/bin`.

Затем необходимо настроить [nginx](https://nginx.org/) по примеру в `conf/nginx.conf`, и HTTPS, так как приложение без него работать не будет. Можно либо подключить [Cloudflare](https://www.cloudflare.com), либо сгенерировать сертификат через [Let's Encrypt](https://certbot.eff.org) и добавить его в nginx.

## Запуск прокси
Для удобства, вы можете записать все нужные параметры в конфигурационный файл:
```ini
bind = 127.0.0.1:80
domain = vk-api-proxy.example.com
domain-static = vk-static-proxy.example.com
```
... и затем запускать `./vk-proxy -config path/to/config.ini`

#### Параметры запуска
- `-bind` -- ip адрес и порт, на котором будет запущен прокси, можно указать только порт `:80`. Вместо ip адреса можно указать абсолютный путь к unix сокету, например `/var/run/vk-proxy.sock`.
- `-domain` -- основной домен прокси для запросов к апи, картинок и прочего (**обязательно**).
- `-domain-static` -- домен для проксирования VKUI (`static.vk.com`).
- `-log-verbosity` -- `0` писать только ошибки, `1` + статистику каждую минуту, `2` + все запросы, `3` + тело ответа на запрос.
- `-reduce-memory-usage` -- уменьшает использование памяти за счет процессора (по умолчанию выключено).
- `-filter-feed` -- фильтровать ленту новостей от рекламы (по умолчанию включено).
- `-gzip-upstream` -- использовать gzip для запросов к api.vk.com (по умолчанию включено).

## Подключение к прокси
Чтобы подключиться к своему запущенному прокси, вам нужно будет заменить домен апи в приложении на свой, некоторые приложения и модификации позволяют это делать, а для некоторых нужна модификация приложения (будь то Android или iOS версия).

Для подключения к нашему публичному прокси `vk-api-proxy.xtrafrancyz.net`, вы можете скачать уже [готовые приложения со встроенным прокси](https://github.com/xtrafrancyz/vk-proxy/wiki/%D0%9C%D0%BE%D0%B4%D0%B8%D1%84%D0%B8%D1%86%D0%B8%D1%80%D0%BE%D0%B2%D0%B0%D0%BD%D0%BD%D1%8B%D0%B5-%D0%BF%D1%80%D0%B8%D0%BB%D0%BE%D0%B6%D0%B5%D0%BD%D0%B8%D1%8F), либо вручную заменить домен апи в любом моде поддерживающем замену домена.

### Приложения с поддержкой замены домена
Инструкции по подключению и сами приложения (*VTosters*, *ВКонтакте (официальное приложение)*, *Kate Mobile* или *VK Coffee*) вы можете найти здесь: https://xtrafrancyz.net/unblock-vk#modified_apps.

### Настройка старого официального приложения или его модов (версия 4.x)
1. Открываем приложение ВК, заходим в **Настройки** -> **Основные**.
2. Убираем галочку с пункта Proxy (пункт может то появляться, то исчезать).
3. Открываем стандартный номеронабиратель и пишем следующий код: `*#*#856682583#*#*`. Если у вас Samsung или телефон, где этот код не работает, то скачиваем приложение [Secret Codes](https://play.google.com/store/apps/details?id=fr.simon.marquis.secretcodes) и через него заходим в секретное меню ВК.
4. В секретном меню изменяем Домен API и Домен OAuth на свои. В нем же выключаем прокси, если такой пункт есть и включен.
5. Пользуемся!

## Неисправимые баги *(скорее всего)*
- Внешние ссылки не работают из-за https://m.vk.com/away?... Исправить можно или модификацией приложения (скачать его можете [здесь](https://xtrafrancyz.net/unblock-vk#modified_apps)), или включением встроенного прокси.
